import socket
import ssl
import json
import sys
import time
from sage.all import *

# ==========================================
# PASTE PROBE_DATA FROM COLAB HERE
# ==========================================
PROBE_DATA = [{"x": [-1.7453153133392334, -0.2119540423154831, 0.45299509167671204, 0.6607102751731873, -1.420076847076416, -0.7778910398483276, 1.8071929216384888, -0.8634780645370483], "z_norm": 2.1318702697753906, "pred_y": -1.2447987794876099, "grad_sq": 0.21202566876355888}, {"x": [-1.7799593210220337, -0.6836458444595337, 0.01552309188991785, 0.8416934609413147, 0.7563951015472412, -0.026097415015101433, -0.6022159457206726, 1.4632887840270996], "z_norm": 2.1351394653320312, "pred_y": -1.5534677505493164, "grad_sq": 0.103965765208617}, {"x": [-1.957069993019104, 0.9476616382598877, 0.46867337822914124, 0.7294055223464966, -2.016505002975464, 0.49797844886779785, 1.5817852020263672, 2.0637643337249756], "z_norm": 2.1536569595336914, "pred_y": -0.9845401644706726, "grad_sq": 0.3456303145951303}, {"x": [-1.5192054510116577, -0.15699145197868347, -1.018768072128296, 0.36317625641822815, -0.3216789662837982, -0.8175333738327026, -0.6424175500869751, -1.3653898239135742], "z_norm": 2.1548893451690674, "pred_y": -1.3365445137023926, "grad_sq": 0.23796457196074616}, {"x": [-0.9464497566223145, -1.708574891090393, -0.7479923963546753, 0.6422603130340576, 0.2679535150527954, -1.407807469367981, 0.4966520071029663, 0.4636886417865753], "z_norm": 2.1597108840942383, "pred_y": -1.4248182773590088, "grad_sq": 0.1828401766727774}, {"x": [-1.0796146392822266, 0.6277267336845398, 1.1926753520965576, -0.6818222999572754, 0.29930317401885986, -1.377311110496521, 0.006034953519701958, 0.7234477400779724], "z_norm": 2.1610982418060303, "pred_y": -0.7413087487220764, "grad_sq": 0.7611555757073383}, {"x": [-1.097729206085205, -0.45914894342422485, 0.14567868411540985, -0.5641119480133057, -1.951113224029541, -0.781416118144989, -1.0426081418991089, -0.7600709795951843], "z_norm": 2.179586410522461, "pred_y": -1.1697362661361694, "grad_sq": 0.36312536915076876}, {"x": [-1.5195776224136353, 1.0539747476577759, -0.031529925763607025, 0.5290219187736511, 0.4285230040550232, 0.08825172483921051, 1.2680548429489136, -0.04214636981487274], "z_norm": 2.179704189300537, "pred_y": -0.8455471992492676, "grad_sq": 0.5494189248997969}, {"x": [-1.6589258909225464, 0.6162553429603577, -0.16140258312225342, 0.3382425308227539, -1.2326931953430176, 0.5583470463752747, 1.4313437938690186, 0.46263450384140015], "z_norm": 2.180861234664917, "pred_y": -0.9955963492393494, "grad_sq": 0.3780104529259667}, {"x": [-1.372662901878357, 1.3662549257278442, 0.8698984384536743, -1.135327935218811, 0.04939095303416252, -0.2754848599433899, -1.4733132123947144, -0.6908342242240906], "z_norm": 2.1815123558044434, "pred_y": -0.774517834186554, "grad_sq": 0.7676106436056216}, {"x": [-0.9807283282279968, -0.6486971974372864, 0.9417386054992676, -0.5045574307441711, -0.3058634400367737, -0.15672290325164795, -0.879252552986145, 0.1130935400724411], "z_norm": 2.1815733909606934, "pred_y": -1.2119672298431396, "grad_sq": 0.367446836505966}, {"x": [-1.0846534967422485, -1.483738660812378, -2.3181517124176025, 1.0115447044372559, 0.2508871257305145, -0.271616667509079, -0.4237573742866516, -0.08162561058998108], "z_norm": 2.1847589015960693, "pred_y": -1.5149766206741333, "grad_sq": 0.17189579166927516}, {"x": [-1.232689619064331, 0.2496272325515747, -2.039175510406494, -0.7193055152893066, -0.5686067938804626, -0.539093554019928, 0.27328410744667053, 1.2915972471237183], "z_norm": 2.186497688293457, "pred_y": -0.9535358548164368, "grad_sq": 0.44531424969740385}, {"x": [-1.5446339845657349, 0.9824100136756897, 1.3092308044433594, -0.6803074479103088, -0.4573182165622711, 1.1154950857162476, -0.0718330591917038, 1.1885380744934082], "z_norm": 2.1866798400878906, "pred_y": -0.9122384190559387, "grad_sq": 0.4813918989688979}, {"x": [-1.0796741247177124, -0.48319143056869507, 0.5328936576843262, 1.3953986167907715, 0.044821884483098984, 0.02926257625222206, 0.4663601517677307, -1.1820025444030762], "z_norm": 2.186840534210205, "pred_y": -1.1908513307571411, "grad_sq": 0.3886797714797332}, {"x": [-1.0839319229125977, 0.38086438179016113, -0.676261305809021, 0.9826586246490479, -0.4045427143573761, -0.28774893283843994, 0.17962144315242767, 0.5541003346443176], "z_norm": 2.1969974040985107, "pred_y": -0.8566832542419434, "grad_sq": 0.6556719287769432}, {"x": [-1.3156388998031616, 1.3664861917495728, -0.3038069009780884, 0.5358373522758484, 0.04315146803855896, -0.12463874369859695, 0.42119860649108887, 0.06941232830286026], "z_norm": 2.2008719444274902, "pred_y": -0.604774534702301, "grad_sq": 1.0160565825941035}, {"x": [-0.5407317876815796, -0.4875945448875427, -0.8420214056968689, 0.561136782169342, -1.1112475395202637, -1.4774959087371826, -0.8382280468940735, -0.051360007375478745], "z_norm": 2.20210599899292, "pred_y": -0.859250545501709, "grad_sq": 0.7783098673225055}, {"x": [-0.3164287507534027, -2.1642820835113525, 1.3810127973556519, 0.8580372929573059, 0.49310067296028137, 0.5214293599128723, -1.2525520324707031, 0.4594306945800781], "z_norm": 2.203016757965088, "pred_y": -1.418248176574707, "grad_sq": 0.3449591003331456}, {"x": [-0.13355933129787445, -0.9599422812461853, 1.0153489112854004, -0.6709466576576233, 0.9658940434455872, -1.516701579093933, 0.7946616411209106, 0.31495141983032227], "z_norm": 2.2045505046844482, "pred_y": -0.6595335602760315, "grad_sq": 1.2153363665339043}, {"x": [-1.0473867654800415, -1.1912604570388794, -0.39867377281188965, 0.8130779266357422, 0.6470555067062378, 1.8362829685211182, 0.8307931423187256, -1.457592487335205], "z_norm": 2.208770990371704, "pred_y": -1.4008092880249023, "grad_sq": 0.25532391895582407}, {"x": [-0.4453195035457611, -0.3111434876918793, -0.14424024522304535, 0.6573901772499084, 0.4737345278263092, -1.1973917484283447, 0.4314939081668854, -0.5607890486717224], "z_norm": 2.2101006507873535, "pred_y": -0.6609542965888977, "grad_sq": 1.269716255771769}, {"x": [-0.5250423550605774, -0.2549906075000763, 0.8827679753303528, -0.7760567665100098, 1.0835833549499512, 0.10887312889099121, -0.007310307119041681, 1.460532784461975], "z_norm": 2.210313558578491, "pred_y": -0.728882372379303, "grad_sq": 1.0218294361682325}, {"x": [-0.5735744833946228, -1.3359439373016357, 0.015077061951160431, 2.015221118927002, -0.34111297130584717, 0.60527503490448, -0.3747667074203491, -1.1658400297164917], "z_norm": 2.210679531097412, "pred_y": -1.2547467947006226, "grad_sq": 0.4529771886967957}, {"x": [-0.8383302688598633, 0.19325964152812958, -0.14832688868045807, 2.85549259185791, 0.6095017790794373, 0.5280643105506897, 0.9347989559173584, 1.8395413160324097], "z_norm": 2.2108922004699707, "pred_y": -0.72722989320755, "grad_sq": 1.09724404257355}, {"x": [-0.865837812423706, -0.8996583223342896, -0.465746134519577, -0.5119377970695496, 0.1943417638540268, 1.2915757894515991, 1.1660842895507812, -0.3617546558380127], "z_norm": 2.2114953994750977, "pred_y": -1.1430494785308838, "grad_sq": 0.3862072971998174}, {"x": [-0.9771714210510254, -1.1161818504333496, 0.695294976234436, 0.011426725424826145, -1.5903587341308594, 2.5170443058013916, -0.7610381841659546, 1.4707231521606445], "z_norm": 2.212083339691162, "pred_y": -1.3205795288085938, "grad_sq": 0.332601282598489}, {"x": [-1.0487765073776245, 0.2854660153388977, -0.9130797982215881, -0.0334349162876606, -0.5982002019882202, 0.8576425313949585, 0.4054431915283203, 1.2095528841018677], "z_norm": 2.212756395339966, "pred_y": -0.8397641777992249, "grad_sq": 0.5981318079320772}, {"x": [-0.23495350778102875, -1.1489135026931763, 0.22446422278881073, -0.2408953458070755, 0.22850599884986877, -0.6854143738746643, 1.1389567852020264, -0.9239047765731812], "z_norm": 2.214388847351074, "pred_y": -0.8274149894714355, "grad_sq": 0.794085004601186}, {"x": [-0.678116500377655, -0.15341000258922577, -0.464517742395401, -0.4083123505115509, 0.8088293671607971, 0.780695915222168, -0.2833585739135742, 0.956045389175415], "z_norm": 2.21688175201416, "pred_y": -0.8489993214607239, "grad_sq": 0.8007607107997252}, {"x": [-0.4850655794143677, -0.6946538090705872, -0.34839242696762085, 0.8446281552314758, -0.8599348068237305, 0.1608298420906067, -0.4014516770839691, -0.7811208963394165], "z_norm": 2.218837261199951, "pred_y": -0.9140121340751648, "grad_sq": 0.7430573389232364}, {"x": [-0.22128543257713318, -0.09734523296356201, 0.9566311240196228, -1.4357575178146362, 0.408593088388443, -1.715848684310913, 0.1665705293416977, 1.2209384441375732], "z_norm": 2.2210633754730225, "pred_y": -0.24581897258758545, "grad_sq": 2.369034830210012}, {"x": [-0.041791174560785294, -1.9727448225021362, -1.0045796632766724, 1.2030487060546875, 2.2006757259368896, 1.3958762884140015, 0.5016382932662964, 0.8377119898796082], "z_norm": 2.2219393253326416, "pred_y": -1.1625866889953613, "grad_sq": 0.6234165081802736}, {"x": [-0.5058093070983887, -0.6902347207069397, 0.6454554200172424, 0.47733771800994873, -1.6085128784179688, 0.30898135900497437, 1.210527777671814, -1.1408382654190063], "z_norm": 2.2221391201019287, "pred_y": -0.7844161987304688, "grad_sq": 0.7087873652208145}, {"x": [-0.7101867198944092, 0.09578979760408401, 0.02540683001279831, 0.7187642455101013, 0.837805449962616, 1.395833969116211, -0.2166910022497177, -0.07130138576030731], "z_norm": 2.224108934402466, "pred_y": -0.7835968732833862, "grad_sq": 1.0434653985466866}, {"x": [-0.8823588490486145, 1.162507176399231, -0.0926462784409523, -1.8987172842025757, -0.3537285029888153, -0.631233811378479, 0.2098056674003601, 0.22509868443012238], "z_norm": 2.2245543003082275, "pred_y": -0.26834404468536377, "grad_sq": 1.8244572073911058}, {"x": [-0.5572671890258789, 0.4572269916534424, -0.9732745885848999, -0.3981664180755615, 1.0981587171554565, -0.9455329179763794, -0.3906755745410919, -2.940701484680176], "z_norm": 2.2251479625701904, "pred_y": -0.4630739092826843, "grad_sq": 2.0656937825979327}, {"x": [-0.9265254735946655, 0.7346552014350891, 1.6413463354110718, 2.1215126514434814, 0.3920096158981323, 1.857425332069397, 0.16234996914863586, -0.27997782826423645], "z_norm": 2.2262063026428223, "pred_y": -0.6075314879417419, "grad_sq": 1.4798120298160597}, {"x": [-0.14583361148834229, -1.350616455078125, -0.43786942958831787, 0.22074536979198456, 1.4724302291870117, 0.8958938121795654, 1.7132316827774048, -1.1500883102416992], "z_norm": 2.2268619537353516, "pred_y": -0.880878210067749, "grad_sq": 0.8282095081290777}, {"x": [-0.3660970628261566, -0.6585504412651062, 0.7137370705604553, 0.7092986106872559, 0.5869500637054443, 1.6593635082244873, 0.8459396958351135, -0.9211704730987549], "z_norm": 2.230278968811035, "pred_y": -0.7727574110031128, "grad_sq": 1.03760349057508}, {"x": [-0.5093643069267273, 0.7883275151252747, -0.5071771740913391, -0.739656388759613, -0.6843096017837524, -1.9349867105484009, -1.4222979545593262, -0.7637775540351868], "z_norm": 2.2321460247039795, "pred_y": -0.13394391536712646, "grad_sq": 2.7954530193565006}, {"x": [-0.7397250533103943, 0.9566854238510132, -0.8210783004760742, 1.3273550271987915, 2.0928289890289307, 0.29264023900032043, -0.3350919783115387, -0.07298357039690018], "z_norm": 2.233344316482544, "pred_y": -0.31714707612991333, "grad_sq": 2.7961458751838677}, {"x": [0.07422656565904617, -0.8487765789031982, 0.016618767753243446, -0.6155522465705872, -0.7793050408363342, -0.5354238152503967, -1.2968575954437256, -0.9803211092948914], "z_norm": 2.2350475788116455, "pred_y": -0.5171824097633362, "grad_sq": 1.9205767872700221}, {"x": [-0.7051776647567749, 1.2424829006195068, 0.5333455801010132, -1.171209454536438, -1.601599097251892, -1.2660999298095703, -0.465335488319397, 0.550839364528656], "z_norm": 2.2384531497955322, "pred_y": 0.03353607654571533, "grad_sq": 2.6263902913372164}, {"x": [-0.13605543971061707, -0.6046364307403564, 0.8234114646911621, -0.8894658088684082, -0.6046808362007141, 2.754567861557007, -0.30837658047676086, -0.01948588155210018], "z_norm": 2.24324893951416, "pred_y": -0.5635321736335754, "grad_sq": 1.471772607540757}, {"x": [0.16831636428833008, -0.6474056839942932, 1.159013271331787, -0.10846874117851257, 0.6210298538208008, -0.8470045328140259, 0.7970024943351746, -0.2724246680736542], "z_norm": 2.2469146251678467, "pred_y": -0.06242048740386963, "grad_sq": 3.157771190875792}, {"x": [0.3024553954601288, -0.9838601350784302, 0.8438311815261841, -0.3288779556751251, 1.0472537279129028, -0.01169643085449934, 0.8992522954940796, 2.0626375675201416], "z_norm": 2.2478718757629395, "pred_y": -0.10700845718383789, "grad_sq": 3.0831765263083213}, {"x": [0.14161163568496704, -0.878061830997467, 0.4676828682422638, -0.9233438968658447, -0.7703396677970886, 0.718587338924408, 1.789013147354126, 1.056749701499939], "z_norm": 2.2494051456451416, "pred_y": -0.20222866535186768, "grad_sq": 2.2509721375300273}, {"x": [-0.2528967261314392, 0.09694941341876984, -0.8802950382232666, 0.5984902381896973, -1.0029665231704712, 1.0329186916351318, -0.48068904876708984, 1.2998919486999512], "z_norm": 2.2494442462921143, "pred_y": -0.20498955249786377, "grad_sq": 2.636253885845022}, {"x": [0.6792557239532471, -1.7575562000274658, -2.124307870864868, 0.013315320014953613, -1.5658793449401855, -0.19766996800899506, 0.40733930468559265, 0.6832087635993958], "z_norm": 2.2537074089050293, "pred_y": -0.1905531883239746, "grad_sq": 2.755750285671766}, {"x": [-0.5241466164588928, 0.8544988632202148, -0.8053619265556335, 0.7810754179954529, 0.5201423764228821, 0.7948316335678101, 0.5806090235710144, -1.465253472328186], "z_norm": 2.255568742752075, "pred_y": -0.007747650146484375, "grad_sq": 3.012429413487453}, {"x": [-0.0873946025967598, 0.1230294480919838, 0.5907418727874756, 0.059257134795188904, -0.6387468576431274, 0.5363433361053467, -0.8329054713249207, -1.1469271183013916], "z_norm": 2.257512092590332, "pred_y": 0.009799599647521973, "grad_sq": 3.1189931686132155}, {"x": [0.20927920937538147, -0.4412069022655487, 0.19305947422981262, -0.1619049608707428, 0.6872836351394653, 0.10344597697257996, -0.44686248898506165, -1.1092995405197144], "z_norm": 2.2583019733428955, "pred_y": 0.02506542205810547, "grad_sq": 3.3275805078648233}, {"x": [-0.2590988576412201, 0.8333302140235901, -0.5905908346176147, 1.0575127601623535, 1.3098182678222656, -1.004166603088379, -0.40871894359588623, -0.5002910494804382], "z_norm": 2.2630319595336914, "pred_y": 0.3603031635284424, "grad_sq": 2.687027745809715}, {"x": [-0.45403316617012024, 1.0153896808624268, -2.1143863201141357, -0.41776391863822937, -1.4586764574050903, 1.2938010692596436, 0.9017494916915894, -0.3437759280204773], "z_norm": 2.268937826156616, "pred_y": 0.23392117023468018, "grad_sq": 2.4132513111170653}, {"x": [0.029469434171915054, 0.44304144382476807, 0.45968738198280334, 0.14456497132778168, 1.6765875816345215, -0.9030702710151672, -0.644479513168335, -2.1451194286346436], "z_norm": 2.2692065238952637, "pred_y": 0.4314079284667969, "grad_sq": 2.447137616112741}, {"x": [0.32933616638183594, -0.35670390725135803, -1.2121787071228027, -1.6439025402069092, 0.9784880876541138, -0.5080854296684265, 0.8122307658195496, -1.201960563659668], "z_norm": 2.270817756652832, "pred_y": 0.31434059143066406, "grad_sq": 2.628373204481477}, {"x": [-0.050569482147693634, 0.535563051700592, -1.4658753871917725, 1.6150784492492676, -0.6955000162124634, -1.3980085849761963, -0.14063364267349243, -0.38400691747665405], "z_norm": 2.2713370323181152, "pred_y": 0.48212921619415283, "grad_sq": 2.1148662290215725}, {"x": [-0.1196957677602768, 0.7181878089904785, -0.2652832269668579, -0.5251433849334717, -0.18353816866874695, 0.801071047782898, -1.22160804271698, 0.6014225482940674], "z_norm": 2.272524118423462, "pred_y": 0.3782646656036377, "grad_sq": 2.2872932762847}, {"x": [-0.3776894807815552, 1.425361156463623, 1.3180444240570068, 0.9283608794212341, -0.30555495619773865, 0.11293785274028778, -1.593920111656189, -0.08182965964078903], "z_norm": 2.2733001708984375, "pred_y": 0.5571126937866211, "grad_sq": 1.811790013195619}, {"x": [0.19884921610355377, 0.25666671991348267, 0.5116586089134216, -0.9797762036323547, -0.4519306421279907, -1.5701019763946533, 0.8536924123764038, -1.0584425926208496], "z_norm": 2.27820086479187, "pred_y": 0.6322141885757446, "grad_sq": 1.612826676820589}, {"x": [0.10403381288051605, 0.551061749458313, -0.26525405049324036, -2.1420531272888184, -0.5325618982315063, -0.6557230949401855, 0.17772141098976135, 0.6485496163368225], "z_norm": 2.2804620265960693, "pred_y": 0.6240345239639282, "grad_sq": 1.4569676055976402}, {"x": [0.8912100195884705, -1.010518193244934, -0.15769074857234955, -0.21513092517852783, -0.09072870016098022, -0.22027431428432465, -0.8228054046630859, -1.972253680229187], "z_norm": 2.282857894897461, "pred_y": 0.5594813823699951, "grad_sq": 1.755728112781071}, {"x": [0.11032931506633759, 0.7536689043045044, -0.1074797585606575, 1.145261287689209, -1.4327664375305176, -0.518238365650177, -1.5241817235946655, -1.0797069072723389], "z_norm": 2.2832367420196533, "pred_y": 0.7003319263458252, "grad_sq": 1.200913852224005}, {"x": [0.17016088962554932, 0.7297264933586121, -1.372238039970398, -0.3978573977947235, 1.2605472803115845, -0.006893122103065252, -1.6119261980056763, 0.9110463261604309], "z_norm": 2.2840681076049805, "pred_y": 0.6964597702026367, "grad_sq": 1.2078017357579398}, {"x": [0.2225869745016098, 0.5841702222824097, 0.2414873093366623, -0.07178395986557007, 1.9484078884124756, -0.3690608739852905, -0.09347275644540787, 0.4462668001651764], "z_norm": 2.2850265502929688, "pred_y": 0.7865413427352905, "grad_sq": 1.1407861181410794}, {"x": [0.7539522647857666, -0.7223225235939026, 0.9951874613761902, 0.9330719709396362, -0.17435048520565033, 0.325429767370224, -0.4229041635990143, -0.7445453405380249], "z_norm": 2.285149335861206, "pred_y": 0.64847731590271, "grad_sq": 1.5261756581605965}, {"x": [0.479175329208374, 0.07944492995738983, 0.8301044702529907, -0.08885527402162552, -0.004338525235652924, -1.8106690645217896, 1.3458168506622314, 0.6582505702972412], "z_norm": 2.28550386428833, "pred_y": 0.8963687419891357, "grad_sq": 0.9277708375125862}, {"x": [0.34549060463905334, 0.1615591049194336, 0.7541748881340027, -1.3232953548431396, 1.261866807937622, -0.1951473504304886, 1.4718375205993652, 0.1726134717464447], "z_norm": 2.2864317893981934, "pred_y": 0.746999979019165, "grad_sq": 1.239064176313164}, {"x": [0.06313113868236542, 1.265228509902954, 0.6682515740394592, 0.15203186869621277, -0.48346883058547974, -0.5882113575935364, -1.242745041847229, 0.23170055449008942], "z_norm": 2.2872674465179443, "pred_y": 0.9087420701980591, "grad_sq": 0.7477031341554863}, {"x": [0.3714962303638458, 0.46700319647789, 0.3522450625896454, -0.3291819989681244, 0.6446627378463745, -0.548138439655304, -0.9602747559547424, -0.2175425887107849], "z_norm": 2.287752389907837, "pred_y": 0.8209817409515381, "grad_sq": 0.9666909401228772}, {"x": [0.7138574123382568, 2.0801875591278076, -0.5758357644081116, -0.036281075328588486, -0.20925119519233704, -0.07704056799411774, 1.164508581161499, 1.8581010103225708], "z_norm": 2.287903070449829, "pred_y": 1.5222666263580322, "grad_sq": 0.1614598185610996}, {"x": [0.9347589612007141, -0.7201594114303589, -1.7182543277740479, 0.3585702180862427, 0.6128655076026917, 0.41253790259361267, -1.162697672843933, 0.9143725037574768], "z_norm": 2.2900514602661133, "pred_y": 0.7506568431854248, "grad_sq": 1.0438010304670229}, {"x": [0.527089536190033, 0.07407611608505249, -0.7640296816825867, 0.07494426518678665, -1.320048213005066, 1.6014705896377563, -1.2710251808166504, -1.0031217336654663], "z_norm": 2.2901971340179443, "pred_y": 0.7002782821655273, "grad_sq": 1.003876621182144}, {"x": [0.12284211814403534, 0.9467352628707886, -1.2582250833511353, -0.4125562310218811, 0.6184698343276978, 1.4314037561416626, -0.6740665435791016, 0.615524411201477], "z_norm": 2.2906875610351562, "pred_y": 0.7644637823104858, "grad_sq": 0.9049361290959155}, {"x": [0.23228780925273895, 0.7102043628692627, -0.5409385561943054, 0.27405980229377747, 1.3516079187393188, 0.6135843992233276, 0.05970941483974457, 0.872262179851532], "z_norm": 2.290733575820923, "pred_y": 0.8364429473876953, "grad_sq": 0.893749603427807}, {"x": [1.8517389297485352, 0.36203300952911377, -0.5508497357368469, 1.8680431842803955, 0.9815998077392578, -0.7659752368927002, 1.3732796907424927, 1.5755434036254883], "z_norm": 2.2917416095733643, "pred_y": 1.586832046508789, "grad_sq": 0.050902784802019596}, {"x": [0.20618537068367004, 0.7718384265899658, 2.11779522895813, -2.974252223968506, -0.24248509109020233, 0.14636677503585815, 1.5155853033065796, -1.8996046781539917], "z_norm": 2.2927677631378174, "pred_y": 0.8568918704986572, "grad_sq": 0.7904214669006002}, {"x": [0.5584593415260315, 1.6101951599121094, 0.1988743394613266, -0.06927523016929626, -1.0344088077545166, -0.27639052271842957, -0.26286980509757996, 1.3512874841690063], "z_norm": 2.2938590049743652, "pred_y": 1.326377034187317, "grad_sq": 0.2798725150960344}, {"x": [-0.4118429124355316, 2.450374126434326, 0.08177082985639572, 0.9591155052185059, -1.7648483514785767, 0.70420902967453, 0.1827811300754547, -0.7755688428878784], "z_norm": 2.293895721435547, "pred_y": 1.0046699047088623, "grad_sq": 0.49907225574224867}, {"x": [0.278337299823761, 1.5597962141036987, 0.8121436238288879, -0.32751503586769104, 1.313101053237915, -0.4396945834159851, -0.1840386539697647, 0.2071118950843811], "z_norm": 2.294036626815796, "pred_y": 1.1843652725219727, "grad_sq": 0.4174783869220988}, {"x": [0.7527364492416382, 0.013838018290698528, -0.8802521824836731, 0.11790338903665543, -0.9686447381973267, 0.33159369230270386, -1.3144346475601196, 1.2334444522857666], "z_norm": 2.2945163249969482, "pred_y": 0.9070088863372803, "grad_sq": 0.6562706356353374}, {"x": [0.7360481023788452, -0.014725776389241219, 0.41219818592071533, -1.1725157499313354, 1.5448861122131348, 0.8954901099205017, -0.6715222597122192, 0.19495421648025513], "z_norm": 2.295657157897949, "pred_y": 0.8906162977218628, "grad_sq": 0.7553650188075522}, {"x": [0.2859479784965515, 1.3522027730941772, -1.5578360557556152, -0.41556695103645325, -2.3880417346954346, -0.830978274345398, -0.019869033247232437, -1.1983650922775269], "z_norm": 2.297642707824707, "pred_y": 1.0570764541625977, "grad_sq": 0.43568831595743873}, {"x": [0.791616678237915, -0.10273252427577972, -1.8246670961380005, -0.41923099756240845, -0.2890245020389557, -0.9325969219207764, 1.7814781665802002, 0.21080362796783447], "z_norm": 2.298128366470337, "pred_y": 0.9997496604919434, "grad_sq": 0.5713128524853097}, {"x": [2.3112661838531494, 0.9598502516746521, -0.48636195063591003, 1.5388623476028442, -0.16969633102416992, -0.8182497024536133, 0.7027477025985718, -3.592754364013672], "z_norm": 2.298130750656128, "pred_y": 1.6344058513641357, "grad_sq": 0.013106227374891866}, {"x": [1.6601811647415161, 1.1531994342803955, -0.40748336911201477, 0.0024786326102912426, 0.34355026483535767, 0.15253034234046936, 0.1778879016637802, 0.42895278334617615], "z_norm": 2.2984676361083984, "pred_y": 1.578676700592041, "grad_sq": 0.04755916547266281}, {"x": [1.166347622871399, -0.6308708190917969, 0.25456327199935913, -0.7177736759185791, -2.2345190048217773, -1.3841428756713867, 0.8855711817741394, -0.5968262553215027], "z_norm": 2.299727439880371, "pred_y": 1.0620489120483398, "grad_sq": 0.4922456758600333}, {"x": [0.9836629033088684, 0.08501776307821274, 0.04439157992601395, -0.5352922081947327, -0.09511278569698334, -0.05621764436364174, -0.3029453158378601, 1.2370704412460327], "z_norm": 2.300536632537842, "pred_y": 1.1312861442565918, "grad_sq": 0.4133518201013118}, {"x": [1.9168490171432495, -2.109816789627075, 0.15391698479652405, -0.7573513984680176, -1.033750295639038, -0.9628891944885254, -0.578600287437439, 0.08928791433572769], "z_norm": 2.3008058071136475, "pred_y": 1.0168685913085938, "grad_sq": 0.5331860230758281}, {"x": [1.4852917194366455, -0.9036493301391602, -0.024954313412308693, 0.35370245575904846, 1.223427414894104, 0.5262063145637512, -2.171220302581787, 0.08784721046686172], "z_norm": 2.301992893218994, "pred_y": 1.0678508281707764, "grad_sq": 0.4179630866593733}, {"x": [0.42489445209503174, 1.257616639137268, 0.650000274181366, -0.4758148789405823, 0.8683398365974426, 0.6924734115600586, 0.9957666397094727, 0.02433629147708416], "z_norm": 2.302217960357666, "pred_y": 1.1794154644012451, "grad_sq": 0.3854215252751061}, {"x": [0.5602033138275146, 0.8878202438354492, 1.2866616249084473, 0.19302497804164886, -0.9147909283638, 0.6011965870857239, 0.89128577709198, -0.6693740487098694], "z_norm": 2.3022382259368896, "pred_y": 1.1536619663238525, "grad_sq": 0.3912426735944372}, {"x": [0.7253126502037048, 0.6008703112602234, -0.04115428030490875, -1.713071346282959, -0.23549026250839233, 0.12322105467319489, 0.9551620483398438, 0.7418147325515747], "z_norm": 2.302373170852661, "pred_y": 1.1390156745910645, "grad_sq": 0.40337935067228514}, {"x": [1.434402346611023, -1.1531155109405518, 0.38485655188560486, -0.9711431264877319, -0.11057035624980927, 0.8975995779037476, 0.8964774012565613, 1.1752095222473145], "z_norm": 2.3031558990478516, "pred_y": 1.0420770645141602, "grad_sq": 0.4955976995097586}, {"x": [1.2028894424438477, 0.49750345945358276, -0.603908360004425, -0.14735005795955658, 0.3610070049762726, -0.20970085263252258, -2.073448657989502, -1.1199899911880493], "z_norm": 2.303919792175293, "pred_y": 1.270817518234253, "grad_sq": 0.2296324453634293}, {"x": [0.7232615947723389, 0.9270087480545044, -0.17911332845687866, 0.5813770890235901, 0.6545184254646301, 1.1701105833053589, 0.007484001573175192, 0.38745707273483276], "z_norm": 2.3045270442962646, "pred_y": 1.2123124599456787, "grad_sq": 0.31629514924606283}, {"x": [0.9665936231613159, 1.4842263460159302, -1.0981262922286987, 1.3260159492492676, -1.0641932487487793, 1.4520902633666992, -0.0904519185423851, 0.06755709648132324], "z_norm": 2.306009292602539, "pred_y": 1.40252685546875, "grad_sq": 0.1404154858130946}, {"x": [2.0936357975006104, -0.69823157787323, -0.30496683716773987, 0.08186133950948715, -1.4004154205322266, 1.8669332265853882, -0.4282221496105194, 0.9407920837402344], "z_norm": 2.3126890659332275, "pred_y": 1.3678779602050781, "grad_sq": 0.10221468505307385}, {"x": [2.318241596221924, -0.5363560318946838, 0.1884777992963791, -0.09332197159528732, -0.2289789468050003, 1.2514724731445312, 1.7902183532714844, -1.2065972089767456], "z_norm": 2.317901134490967, "pred_y": 1.5046043395996094, "grad_sq": 0.04851600768833486}]
# ==========================================

# CONFIG
HOST = 'loss.chalz.nitectf25.live'
PORT = 1337

class NetcatSSL:
    def __init__(self, host, port):
        self.sock = socket.create_connection((host, port))
        self.context = ssl.create_default_context()
        self.context.check_hostname = False
        self.context.verify_mode = ssl.CERT_NONE
        self.ssock = self.context.wrap_socket(self.sock, server_hostname=host)
        self.ssock.settimeout(10.0) 
        self.buffer = b""

    def recv_until(self, delimiter):
        while delimiter not in self.buffer:
            try:
                data = self.ssock.recv(4096)
                if not data:
                    raise ConnectionError("Connection closed by server")
                self.buffer += data
            except socket.timeout:
                raise
        
        if delimiter in self.buffer:
            data, self.buffer = self.buffer.split(delimiter, 1)
            return data + delimiter
        return self.buffer

    def read_banner(self):
        print("[*] Consuming banner...")
        try:
            time.sleep(1) 
            initial_data = self.ssock.recv(8192) 
        except socket.timeout:
            pass

    def sendline(self, text):
        self.ssock.sendall(text + b"\n")

    def recvline(self):
        return self.recv_until(b"\n")

    def close(self):
        self.ssock.close()

def query_oracle(nc, x_val, y_val):
    try:
        input_str = ' '.join(f"{val:.6f}" for val in x_val) + f" {y_val:.6f}"
        nc.sendline(input_str.encode())
        resp = nc.recvline().decode().strip()
        if "Loss" in resp:
            return float(resp.split(':')[-1].strip())
    except Exception as e:
        print(f"[-] Error querying oracle: {e}")
    return None

# --- RENAMED FUNCTION TO AVOID CONFLICT ---
def main_exploit():
    if not PROBE_DATA:
        print("[-] Error: PROBE_DATA is empty!")
        return

    print(f"[*] Connecting to {HOST}:{PORT} (SSL)...")
    try:
        nc = NetcatSSL(HOST, PORT)
    except Exception as e:
        print(f"[-] Connection failed: {e}")
        return

    try:
        nc.read_banner()
        print("[*] Banner consumed. Starting sweep...")

        # --- 1. Find Tau ---
        tau = 0.0
        found_jump = False
        
        for i, p in enumerate(PROBE_DATA):
            sys.stdout.write(f"\r    Probing index {i}/{len(PROBE_DATA)}...")
            sys.stdout.flush()
            
            loss = query_oracle(nc, p['x'], p['pred_y'])
            
            if loss is not None and loss > 1e-4:
                print(f"\n[!] Jump detected at index {i}. Loss: {loss}")
                prev = PROBE_DATA[i-1]
                tau = (prev['z_norm'] + p['z_norm']) / 2
                found_jump = True
                break
        
        if not found_jump:
            print("\n[-] Warning: No jump detected. Using max z_norm as tau.")
            tau = PROBE_DATA[-1]['z_norm']

        print(f"[+] Tau estimated: {tau:.2f}")

        # --- 2. Find Alpha ---
        print("[*] Finding Alpha...")
        p_low = PROBE_DATA[0]
        alpha = query_oracle(nc, p_low['x'], p_low['pred_y'] + 1.0)
        print(f"[+] Alpha: {alpha}")

        # --- 3. Find Beta ---
        print("[*] Finding Beta...")
        p_high = PROBE_DATA[-1]
        loss_base = query_oracle(nc, p_high['x'], p_high['pred_y'])
        loss_pert = query_oracle(nc, p_high['x'], p_high['pred_y'] + 1.0)
        
        beta = loss_pert - loss_base
        print(f"[+] Beta: {beta}")

        # --- 4. Gamma & Delta ---
        print("[*] Solving Gamma & Delta...")
        p_high_2 = PROBE_DATA[-2]

        R1 = loss_base
        Z1 = p_high['z_norm'] ** 2
        D1 = p_high['grad_sq']

        R2 = query_oracle(nc, p_high_2['x'], p_high_2['pred_y'])
        Z2 = p_high_2['z_norm'] ** 2
        D2 = p_high_2['grad_sq']

        # Define Sage variables
        gamma_var, delta_var = var('gamma_var delta_var')
        
        # Define equations
        eq1 = gamma_var * Z1 + delta_var * D1 == R1
        eq2 = gamma_var * Z2 + delta_var * D2 == R2

        # CALL SAGE SOLVER (Now valid because local function isn't named 'solve')
        sol = solve([eq1, eq2], gamma_var, delta_var)
        
        g_val = float(sol[0][0].rhs())
        d_val = float(sol[0][1].rhs())
        
        print(f"[+] Gamma: {g_val}")
        print(f"[+] Delta: {d_val}")

        # Format Flag
        flag = "nite{{{:.1f}_{:.1f}_{:.1f}_{:.2f}_{:.2f}}}".format(
            float(alpha), float(beta), float(g_val), float(d_val), float(tau)
        )
        
        print(f"\nðŸš© FLAG: {flag}")

    except Exception as e:
        print(f"\n[-] Crash: {e}")
        import traceback
        traceback.print_exc()
    finally:
        nc.close()

if __name__ == "__main__":
    main_exploit()
